"use strict";(self.webpackChunkgame_tavern=self.webpackChunkgame_tavern||[]).push([[8418],{38977:(Z,y,t)=>{t.r(y),t.d(y,{default:()=>ie});var e=t(67294),r=t(334),M=t(40720),T=t(90731),P=t(34726),a=t(80621),l=t(86896),g=t(88767),v=t(84419),n=t(99688),b=t(74622),j=t(36854),s=t(71543),o=t(31988),i=t(6498),d=t(457),c=t(37022),f=t(12473),S=t(82392),I=t(75071),U=t(41054),F=t(45697),u=t.n(F),C=t(87561);const k=C.Ry().shape({options:C.Ry().shape({from:C.Ry().shape({name:C.Z_().required(a.translatedErrors.required),email:C.Z_().email(a.translatedErrors.email).required(a.translatedErrors.required)}).required(),response_email:C.Z_().email(a.translatedErrors.email),object:C.Z_().required(a.translatedErrors.required),message:C.Z_().required(a.translatedErrors.required)}).required(a.translatedErrors.required)}),W=({template:m,onToggle:x,onSubmit:p})=>{const{formatMessage:h}=(0,l.Z)();return e.createElement(b.P,{onClose:x,labelledBy:`${h({id:(0,n.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${h({id:(0,n.OB)(m.display),defaultMessage:m.display})}`},e.createElement(j.x,null,e.createElement(S.O,{label:`${h({id:(0,n.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${h({id:(0,n.OB)(m.display),defaultMessage:m.display})}`},e.createElement(I.$,null,h({id:(0,n.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})),e.createElement(I.$,{isCurrent:!0},h({id:(0,n.OB)(m.display),defaultMessage:m.display})))),e.createElement(U.Formik,{onSubmit:p,initialValues:m,validateOnChange:!1,validationSchema:k,enableReinitialize:!0},({errors:O,values:R,handleChange:L,isSubmitting:z})=>e.createElement(a.Form,null,e.createElement(s.f,null,e.createElement(o.r,{gap:5},e.createElement(i.P,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,n.OB)("PopUpForm.Email.options.from.name.label"),defaultMessage:"Shipper name"},name:"options.from.name",onChange:L,value:R.options.from.name,error:O?.options?.from?.name,type:"text"})),e.createElement(i.P,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,n.OB)("PopUpForm.Email.options.from.email.label"),defaultMessage:"Shipper email"},name:"options.from.email",onChange:L,value:R.options.from.email,error:O?.options?.from?.email,type:"text"})),e.createElement(i.P,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,n.OB)("PopUpForm.Email.options.response_email.label"),defaultMessage:"Response email"},name:"options.response_email",onChange:L,value:R.options.response_email,error:O?.options?.response_email,type:"text"})),e.createElement(i.P,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,n.OB)("PopUpForm.Email.options.object.label"),defaultMessage:"Subject"},name:"options.object",onChange:L,value:R.options.object,error:O?.options?.object,type:"text"})),e.createElement(i.P,{col:12,s:12},e.createElement(d.g,{label:h({id:(0,n.OB)("PopUpForm.Email.options.message.label"),defaultMessage:"Message"}),id:"options.message",onChange:L,value:R.options.message,error:O?.options?.message&&h({id:O.options.message,defaultMessage:O.options.message})})))),e.createElement(c.m,{startActions:e.createElement(f.z,{onClick:x,variant:"tertiary"},"Cancel"),endActions:e.createElement(f.z,{loading:z,type:"submit"},"Finish")}))))};W.propTypes={template:u().shape({display:u().string,icon:u().string,options:u().shape({from:u().shape({name:u().string,email:u().string}),message:u().string,object:u().string,response_email:u().string})}).isRequired,onSubmit:u().func.isRequired,onToggle:u().func.isRequired};const w=W;var q=t(5923),_=t(3547),D=t(29299),B=t(69398),$=t(22304),H=t(10574),ee=t(35752),A=t(85200),G=t(96208),te=t(75975),K=t(2382),ae=t(18226);const V=({canUpdate:m,onEditClick:x})=>{const{formatMessage:p}=(0,l.Z)();return e.createElement(q.i,{colCount:3,rowCount:3},e.createElement(_.h,null,e.createElement(D.Tr,null,e.createElement(B.Th,{width:"1%"},e.createElement($.T,null,p({id:(0,n.OB)("Email.template.table.icon.label"),defaultMessage:"icon"}))),e.createElement(B.Th,null,e.createElement(H.Z,{variant:"sigma",textColor:"neutral600"},p({id:(0,n.OB)("Email.template.table.name.label"),defaultMessage:"name"}))),e.createElement(B.Th,{width:"1%"},e.createElement($.T,null,p({id:(0,n.OB)("Email.template.table.action.label"),defaultMessage:"action"}))))),e.createElement(ee.p,null,e.createElement(D.Tr,{...(0,a.onRowClick)({fn:()=>x("reset_password")})},e.createElement(B.Td,null,e.createElement(A.J,null,e.createElement(te.Z,{"aria-label":p({id:"global.reset-password",defaultMessage:"Reset password"})}))),e.createElement(B.Td,null,e.createElement(H.Z,null,p({id:"global.reset-password",defaultMessage:"Reset password"}))),e.createElement(B.Td,{...a.stopPropagation},e.createElement(G.h,{onClick:()=>x("reset_password"),label:p({id:(0,n.OB)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:m&&e.createElement(K.Z,null)}))),e.createElement(D.Tr,{...(0,a.onRowClick)({fn:()=>x("email_confirmation")})},e.createElement(B.Td,null,e.createElement(A.J,null,e.createElement(ae.Z,{"aria-label":p({id:(0,n.OB)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"})}))),e.createElement(B.Td,null,e.createElement(H.Z,null,p({id:(0,n.OB)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"}))),e.createElement(B.Td,{...a.stopPropagation},e.createElement(G.h,{onClick:()=>x("email_confirmation"),label:p({id:(0,n.OB)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:m&&e.createElement(K.Z,null)})))))};V.propTypes={canUpdate:u().bool.isRequired,onEditClick:u().func.isRequired};const ne=V,se=()=>e.createElement(a.CheckPagePermissions,{permissions:v._.readEmailTemplates},e.createElement(le,null)),le=()=>{const{formatMessage:m}=(0,l.Z)(),{trackUsage:x}=(0,a.useTracking)(),{notifyStatus:p}=(0,r.G)(),h=(0,a.useNotification)(),{lockApp:O,unlockApp:R}=(0,a.useOverlayBlocker)(),L=(0,g.useQueryClient)(),{get:z,put:re}=(0,a.useFetchClient)(),{formatAPIError:Q}=(0,a.useAPIErrorHandler)();(0,a.useFocusWhenNavigate)();const[oe,de]=e.useState(!1),[J,me]=e.useState(null),{isLoading:ce,allowedActions:{canUpdate:ue}}=(0,a.useRBAC)({update:v._.updateEmailTemplates}),{isLoading:pe,data:X}=(0,g.useQuery)(["users-permissions","email-templates"],async()=>{const{data:E}=await z("/users-permissions/email-templates");return E},{onSuccess(){p(m({id:(0,n.OB)("Email.template.data.loaded"),defaultMessage:"Email templates has been loaded"}))},onError(E){h({type:"warning",message:Q(E)})}}),Ee=ce||pe,N=()=>{de(E=>!E)},ge=E=>{me(E),N()},Y=(0,g.useMutation)(E=>re("/users-permissions/email-templates",{"email-templates":E}),{async onSuccess(){await L.invalidateQueries(["users-permissions","email-templates"]),h({type:"success",message:{id:"notification.success.saved",defaultMessage:"Saved"}}),x("didEditEmailTemplates"),R(),N()},onError(E){h({type:"warning",message:Q(E)}),R()},refetchActive:!0}),fe=E=>{O(),x("willEditEmailTemplates");const he={...X,[J]:E};Y.mutate(he)};return Ee?e.createElement(M.o,{"aria-busy":"true"},e.createElement(a.SettingsPageTitle,{name:m({id:(0,n.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(T.T,{title:m({id:(0,n.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(P.D,null,e.createElement(a.LoadingIndicatorPage,null))):e.createElement(M.o,{"aria-busy":Y.isLoading},e.createElement(a.SettingsPageTitle,{name:m({id:(0,n.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(T.T,{title:m({id:(0,n.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(P.D,null,e.createElement(ne,{onEditClick:ge,canUpdate:ue}),oe&&e.createElement(w,{template:X[J],onToggle:N,onSubmit:fe})))},ie=se},99688:(Z,y,t)=>{t.d(y,{YX:()=>T,OB:()=>P.Z});var e=t(41609),r=t.n(e);const T=a=>Object.keys(a).reduce((l,g)=>{const v=a[g].controllers,n=Object.keys(v).reduce((b,j)=>(r()(v[j])||(b[j]=v[j]),b),{});return r()(n)||(l[g]={controllers:n}),l},{});var P=t(58655)},34726:(Z,y,t)=>{t.d(y,{D:()=>M});var e=t(85893),r=t(16607);const M=({children:T})=>(0,e.jsx)(r.x,{paddingLeft:10,paddingRight:10,children:T})},90731:(Z,y,t)=>{t.d(y,{T:()=>n});var e=t(85893),r=t(67294),M=t(54863);const T=s=>{const o=(0,r.useRef)(null),[i,d]=(0,r.useState)(!0),c=([f])=>{d(f.isIntersecting)};return(0,r.useEffect)(()=>{const f=o.current,S=new IntersectionObserver(c,s);return f&&S.observe(o.current),()=>{f&&S.disconnect()}},[o,s]),[o,i]};var P=t(79698);const a=(s,o)=>{const i=(0,P.W)(o);(0,r.useLayoutEffect)(()=>{const d=new ResizeObserver(i);return Array.isArray(s)?s.forEach(c=>{c.current&&d.observe(c.current)}):s.current&&d.observe(s.current),()=>{d.disconnect()}},[s,i])};var l=t(16607),g=t(96987),v=t(10574);const n=s=>{const o=(0,r.useRef)(null),[i,d]=(0,r.useState)(null),[c,f]=T({root:null,rootMargin:"0px",threshold:0});return a(c,()=>{c.current&&d(c.current.getBoundingClientRect())}),(0,r.useEffect)(()=>{o.current&&d(o.current.getBoundingClientRect())},[o]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{style:{height:i?.height},ref:c,children:f&&(0,e.jsx)(j,{ref:o,...s})}),!f&&(0,e.jsx)(j,{...s,sticky:!0,width:i?.width})]})};n.displayName="HeaderLayout";const b=(0,M.default)(l.x)`
  width: ${({width:s})=>s?`${s/16}rem`:void 0};
  z-index: ${({theme:s})=>s.zIndices[1]};
`,j=r.forwardRef(({navigationAction:s,primaryAction:o,secondaryAction:i,subtitle:d,title:c,sticky:f,width:S,...I},U)=>{const F=typeof d=="string";return f?(0,e.jsx)(b,{paddingLeft:6,paddingRight:6,paddingTop:3,paddingBottom:3,position:"fixed",top:0,right:0,background:"neutral0",shadow:"tableShadow",width:S,"data-strapi-header-sticky":!0,children:(0,e.jsxs)(g.k,{justifyContent:"space-between",children:[(0,e.jsxs)(g.k,{children:[s&&(0,e.jsx)(l.x,{paddingRight:3,children:s}),(0,e.jsxs)(l.x,{children:[(0,e.jsx)(v.Z,{variant:"beta",as:"h1",...I,children:c}),F?(0,e.jsx)(v.Z,{variant:"pi",textColor:"neutral600",children:d}):d]}),i?(0,e.jsx)(l.x,{paddingLeft:4,children:i}):null]}),(0,e.jsx)(g.k,{children:o?(0,e.jsx)(l.x,{paddingLeft:2,children:o}):void 0})]})}):(0,e.jsxs)(l.x,{ref:U,paddingLeft:10,paddingRight:10,paddingBottom:8,paddingTop:s?6:8,background:"neutral100","data-strapi-header":!0,children:[s?(0,e.jsx)(l.x,{paddingBottom:2,children:s}):null,(0,e.jsxs)(g.k,{justifyContent:"space-between",children:[(0,e.jsxs)(g.k,{minWidth:0,children:[(0,e.jsx)(v.Z,{as:"h1",variant:"alpha",...I,children:c}),i?(0,e.jsx)(l.x,{paddingLeft:4,children:i}):null]}),o]}),F?(0,e.jsx)(v.Z,{variant:"epsilon",textColor:"neutral600",as:"p",children:d}):d]})})},40720:(Z,y,t)=>{t.d(y,{o:()=>P});var e=t(85893),r=t(54863),M=t(16607);const T=(0,r.default)(M.x)`
  // To prevent global outline on focus visible to force an outline when Main is focused
  &:focus-visible {
    outline: none;
  }
`,P=({labelledBy:a="main-content-title",...l})=>(0,e.jsx)(T,{"aria-labelledby":a,as:"main",id:"main-content",tabIndex:-1,...l})}}]);
