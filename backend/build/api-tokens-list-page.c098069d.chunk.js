"use strict";(self.webpackChunkgame_tavern=self.webpackChunkgame_tavern||[]).push([[8056],{92668:(G,E,t)=>{t.d(E,{Z:()=>p});var e=t(67294),a=t(35752),b=t(29299),u=t(69398),k=t(10574),V=t(96987),r=t(80621),I=t(45697),n=t.n(I),R=t(86896),N=t(16550),D=t(16607),F=t(96208),h=t(54425);const Z=({tokenName:s,onClickDelete:l,tokenType:y})=>{const{formatMessage:g}=(0,R.Z)(),{trackUsage:T}=(0,r.useTracking)(),[f,c]=(0,e.useState)(!1),A=()=>{c(!1),T("willDeleteToken",{tokenType:y}),l()};return e.createElement(D.x,{paddingLeft:1,onClick:d=>d.stopPropagation()},e.createElement(F.h,{onClick:()=>{c(!0)},label:g({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${s}`}),name:"delete",noBorder:!0,icon:e.createElement(h.Z,null)}),e.createElement(r.ConfirmDialog,{onToggleDialog:()=>c(!1),onConfirm:A,isOpen:f}))};Z.propTypes={tokenName:n().string.isRequired,onClickDelete:n().func.isRequired,tokenType:n().string.isRequired};const K=Z;var O=t(81851),j=t(54863);const $={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},z=(0,j.default)(r.Link)`
  svg {
    path {
      fill: ${({theme:s})=>s.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:s})=>s.colors.neutral800};
      }
    }
  }
`,L=({tokenName:s,tokenId:l,buttonType:y,children:g})=>{const{formatMessage:T}=(0,R.Z)(),{location:{pathname:f}}=(0,N.k6)();return e.createElement(z,{to:`${f}/${l}`,title:T($[y],{target:s})},g)};L.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired,buttonType:n().string,children:n().node.isRequired},L.defaultProps={buttonType:"edit"};const v=L,m=({tokenName:s,tokenId:l})=>e.createElement(v,{tokenName:s,tokenId:l,buttonType:"read"},e.createElement(O.Z,null));m.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const B=m;var H=t(2382);const C=({tokenName:s,tokenId:l})=>e.createElement(v,{tokenName:s,tokenId:l},e.createElement(H.Z,null));C.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const W=C,S=({permissions:s,headers:l,contentType:y,isLoading:g,tokens:T,onConfirmDelete:f,tokenType:c})=>{const{canDelete:A,canUpdate:d,canRead:U}=s,P=A||d||U,[{query:x}]=(0,r.useQueryParams)(),{formatMessage:M}=(0,R.Z)(),[,Q]=x?x.sort.split(":"):"ASC",{push:w,location:{pathname:Y}}=(0,N.k6)(),{trackUsage:o}=(0,r.useTracking)(),X=T.sort((i,q)=>{const J=i.name.localeCompare(q.name);return Q==="DESC"?-J:J});return e.createElement(r.DynamicTable,{headers:l,contentType:y,rows:T,withBulkActions:P,isLoading:g,onConfirmDelete:f},e.createElement(a.p,null,X.map(i=>e.createElement(b.Tr,{key:i.id,...(0,r.onRowClick)({fn(){o("willEditTokenFromList",{tokenType:c}),w(`${Y}/${i.id}`)},condition:d})},e.createElement(u.Td,{maxWidth:(0,r.pxToRem)(250)},e.createElement(k.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},i.name)),e.createElement(u.Td,{maxWidth:(0,r.pxToRem)(250)},e.createElement(k.Z,{textColor:"neutral800",ellipsis:!0},i.description)),e.createElement(u.Td,null,e.createElement(k.Z,{textColor:"neutral800"},e.createElement(r.RelativeTime,{timestamp:new Date(i.createdAt)}))),e.createElement(u.Td,null,i.lastUsedAt&&e.createElement(k.Z,{textColor:"neutral800"},e.createElement(r.RelativeTime,{timestamp:new Date(i.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:M({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]}))),P&&e.createElement(u.Td,null,e.createElement(V.k,{justifyContent:"end"},d&&e.createElement(W,{tokenName:i.name,tokenId:i.id}),!d&&U&&e.createElement(B,{tokenName:i.name,tokenId:i.id}),A&&e.createElement(K,{tokenName:i.name,onClickDelete:()=>f(i.id),tokenType:c})))))))};S.propTypes={tokens:n().array,permissions:n().shape({canRead:n().bool,canDelete:n().bool,canUpdate:n().bool}).isRequired,headers:n().arrayOf(n().shape({cellFormatter:n().func,key:n().string.isRequired,metadatas:n().shape({label:n().string.isRequired,sortable:n().bool}).isRequired,name:n().string.isRequired})),contentType:n().string.isRequired,isLoading:n().bool,onConfirmDelete:n().func,tokenType:n().string.isRequired},S.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const p=S},81966:(G,E,t)=>{t.d(E,{Z:()=>e,f:()=>a});const e="api-token",a="transfer-token"},71362:(G,E,t)=>{t.r(E),t.d(E,{default:()=>L});var e=t(67294),a=t(80621),b=t(86706),u=t(36364),k=t(40720),V=t(90731),r=t(34726),I=t(83598),n=t(80129),R=t.n(n),N=t(86896),D=t(88767),F=t(16550),h=t(81966),Z=t(92668);const O=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],$=()=>{(0,a.useFocusWhenNavigate)();const v=(0,D.useQueryClient)(),{formatMessage:m}=(0,N.Z)(),B=(0,a.useNotification)(),H=(0,b.useSelector)(u._),{allowedActions:{canCreate:C,canDelete:W,canUpdate:S,canRead:p}}=(0,a.useRBAC)(H.settings["api-tokens"]),{push:s}=(0,F.k6)(),{trackUsage:l}=(0,a.useTracking)(),{startSection:y}=(0,a.useGuidedTour)(),g=e.useRef(y),{get:T,del:f}=(0,a.useFetchClient)(),{formatAPIError:c}=(0,a.useAPIErrorHandler)();e.useEffect(()=>{g.current&&g.current("apiTokens")},[]),e.useEffect(()=>{s({search:R().stringify({sort:"name:ASC"},{encode:!1})})},[s]);const A=O.map(o=>({...o,metadatas:{...o.metadatas,label:m(o.metadatas.label)}})),{data:d,isLoading:U}=(0,D.useQuery)(["api-tokens"],async()=>{l("willAccessTokenList",{tokenType:h.Z});const{data:{data:o}}=await T("/admin/api-tokens");return l("didAccessTokenList",{number:o.length,tokenType:h.Z}),o},{cacheTime:0,enabled:p,onError(o){B({type:"warning",message:c(o)})}}),P=U,x=(0,D.useMutation)(async o=>{await f(`/admin/api-tokens/${o}`)},{async onSuccess(){await v.invalidateQueries(["api-tokens"]),l("didDeleteToken")},onError(o){B({type:"warning",message:c(o)})}}),M=d&&d.length>0,Q=p&&M,w=p&&!M&&!C,Y=p&&!M&&C;return e.createElement(k.o,{"aria-busy":P},e.createElement(a.SettingsPageTitle,{name:"API Tokens"}),e.createElement(V.T,{title:m({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:m({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:C&&e.createElement(a.LinkButton,{"data-testid":"create-api-token-button",startIcon:e.createElement(I.Z,null),size:"S",onClick:()=>l("willAddTokenFromList",{tokenType:h.Z}),to:"/settings/api-tokens/create"},m({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"}))}),e.createElement(r.D,null,!p&&e.createElement(a.NoPermissions,null),Q&&e.createElement(Z.Z,{permissions:{canRead:p,canDelete:W,canUpdate:S},headers:A,contentType:"api-tokens",rows:d,isLoading:P,onConfirmDelete:o=>x.mutateAsync(o),tokens:d,tokenType:h.Z}),Y&&e.createElement(a.NoContent,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:e.createElement(a.LinkButton,{variant:"secondary",startIcon:e.createElement(I.Z,null),to:"/settings/api-tokens/create"},m({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"}))}),w&&e.createElement(a.NoContent,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},L=()=>{const v=(0,b.useSelector)(u._);return e.createElement(a.CheckPagePermissions,{permissions:v.settings["api-tokens"].main},e.createElement($,null))}}}]);
