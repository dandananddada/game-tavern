"use strict";(self.webpackChunkgame_tavern=self.webpackChunkgame_tavern||[]).push([[9600],{92668:(Q,v,t)=>{t.d(v,{Z:()=>c});var e=t(67294),a=t(35752),P=t(29299),m=t(69398),h=t(10574),x=t(96987),i=t(80621),B=t(45697),n=t.n(B),L=t(86896),I=t(16550),S=t(16607),O=t(96208),C=t(54425);const Z=({tokenName:o,onClickDelete:l,tokenType:k})=>{const{formatMessage:g}=(0,L.Z)(),{trackUsage:T}=(0,i.useTracking)(),[p,y]=(0,e.useState)(!1),u=()=>{y(!1),T("willDeleteToken",{tokenType:k}),l()};return e.createElement(S.x,{paddingLeft:1,onClick:d=>d.stopPropagation()},e.createElement(O.h,{onClick:()=>{y(!0)},label:g({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${o}`}),name:"delete",noBorder:!0,icon:e.createElement(C.Z,null)}),e.createElement(i.ConfirmDialog,{onToggleDialog:()=>y(!1),onConfirm:u,isOpen:p}))};Z.propTypes={tokenName:n().string.isRequired,onClickDelete:n().func.isRequired,tokenType:n().string.isRequired};const G=Z;var F=t(81851),j=t(54863);const $={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},z=(0,j.default)(i.Link)`
  svg {
    path {
      fill: ${({theme:o})=>o.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:o})=>o.colors.neutral800};
      }
    }
  }
`,D=({tokenName:o,tokenId:l,buttonType:k,children:g})=>{const{formatMessage:T}=(0,L.Z)(),{location:{pathname:p}}=(0,I.k6)();return e.createElement(z,{to:`${p}/${l}`,title:T($[k],{target:o})},g)};D.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired,buttonType:n().string,children:n().node.isRequired},D.defaultProps={buttonType:"edit"};const R=D,f=({tokenName:o,tokenId:l})=>e.createElement(R,{tokenName:o,tokenId:l,buttonType:"read"},e.createElement(F.Z,null));f.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const E=f;var w=t(2382);const A=({tokenName:o,tokenId:l})=>e.createElement(R,{tokenName:o,tokenId:l},e.createElement(w.Z,null));A.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const H=A,M=({permissions:o,headers:l,contentType:k,isLoading:g,tokens:T,onConfirmDelete:p,tokenType:y})=>{const{canDelete:u,canUpdate:d,canRead:U}=o,N=u||d||U,[{query:V}]=(0,i.useQueryParams)(),{formatMessage:b}=(0,L.Z)(),[,W]=V?V.sort.split(":"):"ASC",{push:Y,location:{pathname:K}}=(0,I.k6)(),{trackUsage:s}=(0,i.useTracking)(),X=T.sort((r,q)=>{const J=r.name.localeCompare(q.name);return W==="DESC"?-J:J});return e.createElement(i.DynamicTable,{headers:l,contentType:k,rows:T,withBulkActions:N,isLoading:g,onConfirmDelete:p},e.createElement(a.p,null,X.map(r=>e.createElement(P.Tr,{key:r.id,...(0,i.onRowClick)({fn(){s("willEditTokenFromList",{tokenType:y}),Y(`${K}/${r.id}`)},condition:d})},e.createElement(m.Td,{maxWidth:(0,i.pxToRem)(250)},e.createElement(h.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},r.name)),e.createElement(m.Td,{maxWidth:(0,i.pxToRem)(250)},e.createElement(h.Z,{textColor:"neutral800",ellipsis:!0},r.description)),e.createElement(m.Td,null,e.createElement(h.Z,{textColor:"neutral800"},e.createElement(i.RelativeTime,{timestamp:new Date(r.createdAt)}))),e.createElement(m.Td,null,r.lastUsedAt&&e.createElement(h.Z,{textColor:"neutral800"},e.createElement(i.RelativeTime,{timestamp:new Date(r.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:b({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]}))),N&&e.createElement(m.Td,null,e.createElement(x.k,{justifyContent:"end"},d&&e.createElement(H,{tokenName:r.name,tokenId:r.id}),!d&&U&&e.createElement(E,{tokenName:r.name,tokenId:r.id}),u&&e.createElement(G,{tokenName:r.name,onClickDelete:()=>p(r.id),tokenType:y})))))))};M.propTypes={tokens:n().array,permissions:n().shape({canRead:n().bool,canDelete:n().bool,canUpdate:n().bool}).isRequired,headers:n().arrayOf(n().shape({cellFormatter:n().func,key:n().string.isRequired,metadatas:n().shape({label:n().string.isRequired,sortable:n().bool}).isRequired,name:n().string.isRequired})),contentType:n().string.isRequired,isLoading:n().bool,onConfirmDelete:n().func,tokenType:n().string.isRequired},M.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const c=M},81966:(Q,v,t)=>{t.d(v,{Z:()=>e,f:()=>a});const e="api-token",a="transfer-token"},68446:(Q,v,t)=>{t.r(v),t.d(v,{default:()=>D});var e=t(67294),a=t(80621),P=t(86706),m=t(36364),h=t(40720),x=t(90731),i=t(34726),B=t(83598),n=t(80129),L=t.n(n),I=t(86896),S=t(88767),O=t(16550),C=t(81966),Z=t(92668);const F=[{name:"name",key:"name",metadatas:{label:{id:"Settings.tokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.tokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],$=()=>{(0,a.useFocusWhenNavigate)();const R=(0,S.useQueryClient)(),{formatMessage:f}=(0,I.Z)(),E=(0,a.useNotification)(),w=(0,P.useSelector)(m._),{allowedActions:{canCreate:A,canDelete:H,canUpdate:M,canRead:c}}=(0,a.useRBAC)(w.settings["transfer-tokens"]),{push:o}=(0,O.k6)(),{trackUsage:l}=(0,a.useTracking)(),{startSection:k}=(0,a.useGuidedTour)(),g=(0,e.useRef)(k),{get:T,del:p}=(0,a.useFetchClient)();(0,e.useEffect)(()=>{g.current&&g.current("transferTokens")},[]),(0,e.useEffect)(()=>{o({search:L().stringify({sort:"name:ASC"},{encode:!1})})},[o]);const y=F.map(s=>({...s,metadatas:{...s.metadatas,label:f(s.metadatas.label)}})),{data:u,status:d,isFetching:U}=(0,S.useQuery)(["transfer-tokens"],async()=>{l("willAccessTokenList",{tokenType:C.f});const{data:{data:s}}=await T("/admin/transfer/tokens");return l("didAccessTokenList",{number:s.length,tokenType:C.f}),s},{enabled:c,onError(s){console.log("error",s),s?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?E({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):E({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),N=c&&(d!=="success"&&d!=="error"||d==="success"&&U),V=(0,S.useMutation)(async s=>{await p(`/admin/transfer/tokens/${s}`)},{async onSuccess(){await R.invalidateQueries(["transfer-tokens"])},onError(s){s?.response?.data?.data?E({type:"warning",message:s.response.data.data}):s?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?E({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):E({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),b=u&&u?.length>0,W=c&&b,Y=c&&!b&&!A,K=c&&!b&&A;return e.createElement(h.o,{"aria-busy":N},e.createElement(a.SettingsPageTitle,{name:"Transfer Tokens"}),e.createElement(x.T,{title:f({id:"Settings.transferTokens.title",defaultMessage:"Transfer Tokens"}),subtitle:f({id:"Settings.transferTokens.description",defaultMessage:'"List of generated transfer tokens"'}),primaryAction:A?e.createElement(a.LinkButton,{"data-testid":"create-transfer-token-button",startIcon:e.createElement(B.Z,null),size:"S",onClick:()=>l("willAddTokenFromList",{tokenType:C.f}),to:"/settings/transfer-tokens/create"},f({id:"Settings.transferTokens.create",defaultMessage:"Create new Transfer Token"})):void 0}),e.createElement(i.D,null,!c&&e.createElement(a.NoPermissions,null),W&&e.createElement(Z.Z,{permissions:{canRead:c,canDelete:H,canUpdate:M},headers:y,contentType:"trasfer-tokens",rows:u,isLoading:N,onConfirmDelete:s=>V.mutateAsync(s),tokens:u,tokenType:C.f}),K&&e.createElement(a.NoContent,{content:{id:"Settings.transferTokens.addFirstToken",defaultMessage:"Add your first Transfer Token"},action:e.createElement(a.LinkButton,{variant:"secondary",startIcon:e.createElement(B.Z,null),to:"/settings/transfer-tokens/create"},f({id:"Settings.transferTokens.addNewToken",defaultMessage:"Add new Transfer Token"}))}),Y&&e.createElement(a.NoContent,{content:{id:"Settings.transferTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},D=()=>{const R=(0,P.useSelector)(m._);return e.createElement(a.CheckPagePermissions,{permissions:R.settings["transfer-tokens"].main},e.createElement($,null))}}}]);
