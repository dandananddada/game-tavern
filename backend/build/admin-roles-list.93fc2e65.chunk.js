"use strict";(self.webpackChunkgame_tavern=self.webpackChunkgame_tavern||[]).push([[3455],{51754:(N,p,t)=>{t.d(p,{F:()=>c});var e=t(80621),n=t(86896),i=t(88767);const c=(u={},A={})=>{const{id:D="",...y}=u,{get:B}=(0,e.useFetchClient)(),{locale:o}=(0,n.Z)(),I=(0,e.useCollator)(o,{sensitivity:"base"}),{data:C,error:b,isError:d,isLoading:R,refetch:k}=(0,i.useQuery)(["roles",D,y],async()=>{const{data:W}=await B(`/admin/roles/${D??""}`,{params:y});return W},A);let j=[];return D&&C?j=[C.data]:Array.isArray(C?.data)&&(j=C.data),{roles:j.sort((W,V)=>I.compare(W.name,V.name)),error:b,isError:d,isLoading:R,refetch:k}}},7513:(N,p,t)=>{t.r(p),t.d(p,{default:()=>ue});var e=t(67294),n=t(80621),i=t(86706),c=t(36364),u=t(40720),A=t(90731),D=t(12473),y=t(55040),B=t(34726),o=t(5923),I=t(38454),C=t(3547),b=t(29299),d=t(69398),R=t(10574),k=t(22304),j=t(35752),W=t(43838),V=t(2382),w=t(54425),X=t(83598),H=t(86896),q=t(16550),_=t(51754);const ee=()=>"todo empty role";var te=t(96987),ne=t(16607),le=t(96208),ae=t(45697),v=t.n(ae);const Q=({id:a,name:m,description:s,usersCount:M,icons:r,rowIndex:Z,canUpdate:E})=>{const{formatMessage:L}=(0,H.Z)(),[,P]=r,g=L({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:M});return e.createElement(b.Tr,{"aria-rowindex":Z,key:a,...E?(0,n.onRowClick)({fn:P.onClick}):{}},e.createElement(d.Td,{maxWidth:(0,n.pxToRem)(130)},e.createElement(R.Z,{ellipsis:!0,textColor:"neutral800"},m)),e.createElement(d.Td,{maxWidth:(0,n.pxToRem)(250)},e.createElement(R.Z,{ellipsis:!0,textColor:"neutral800"},s)),e.createElement(d.Td,null,e.createElement(R.Z,{textColor:"neutral800"},g)),e.createElement(d.Td,null,e.createElement(te.k,{justifyContent:"flex-end",...n.stopPropagation},r.map((h,x)=>h?e.createElement(ne.x,{key:h.label,paddingLeft:x===0?0:1},e.createElement(le.h,{onClick:h.onClick,label:h.label,noBorder:!0,icon:h.icon})):null))))};Q.propTypes={id:v().number.isRequired,name:v().string.isRequired,description:v().string.isRequired,usersCount:v().number.isRequired,icons:v().array.isRequired,rowIndex:v().number.isRequired,canUpdate:v().bool},Q.defaultProps={canUpdate:!1};const se=Q;var oe=t(18172);const re={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},ie=(a,m)=>(0,oe.default)(a,s=>{switch(m.type){case"ON_REMOVE_ROLES":{s.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{s.shouldRefetchData=!0,s.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{s.shouldRefetchData=!1,s.roleToDelete=null,s.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{s.roleToDelete=m.id;break}default:return s}}),de=({canCreate:a,canDelete:m,canUpdate:s,refetchRoles:M})=>{const{formatMessage:r}=(0,H.Z)(),{formatAPIError:Z}=(0,n.useAPIErrorHandler)(),E=(0,n.useNotification)(),[L,P]=(0,e.useState)(!1),{push:g}=(0,q.k6)(),[{selectedRoles:h,showModalConfirmButtonLoading:x,roleToDelete:z},U]=(0,e.useReducer)(ie,re),{post:G}=(0,n.getFetchClient)(),J=async()=>{try{U({type:"ON_REMOVE_ROLES"}),await G("/admin/roles/batch-delete",{ids:[z]}),await M(),U({type:"RESET_DATA_TO_DELETE"})}catch(l){E({type:"warning",message:Z(l)})}O()},F=(0,e.useCallback)(l=>{g(`/settings/roles/duplicate/${l}`)},[g]),S=()=>g("/settings/roles/new"),K=(0,e.useCallback)(l=>{U({type:"SET_ROLE_TO_DELETE",id:l}),O()},[]),O=()=>P(l=>!l),f=(0,e.useCallback)(l=>{g(`/settings/roles/${l}`)},[g]),$=(0,e.useCallback)((l,T)=>{l.preventDefault(),l.stopPropagation(),T.usersCount?E({type:"info",message:{id:"Roles.ListPage.notification.delete-not-allowed"}}):K(T.id)},[E,K]),Y=(0,e.useCallback)((l,T)=>{l.preventDefault(),l.stopPropagation(),F(T.id)},[F]),me=(0,e.useCallback)(l=>[...a?[{onClick:T=>Y(T,l),label:r({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),icon:e.createElement(W.Z,null)}]:[],...s?[{onClick:()=>f(l.id),label:r({id:"app.utils.edit",defaultMessage:"Edit"}),icon:e.createElement(V.Z,null)}]:[],...m?[{onClick:T=>$(T,l),label:r({id:"global.delete",defaultMessage:"Delete"}),icon:e.createElement(w.Z,null)}]:[]],[r,$,Y,f,a,s,m]);return{handleNewRoleClick:S,getIcons:me,selectedRoles:h,isWarningDeleteAllOpened:L,showModalConfirmButtonLoading:x,handleToggleModal:O,handleDeleteData:J}},ce=()=>{const{formatMessage:a}=(0,H.Z)();(0,n.useFocusWhenNavigate)();const m=(0,i.useSelector)(c._),[{query:s}]=(0,n.useQueryParams)(),{isLoading:M,allowedActions:{canCreate:r,canDelete:Z,canRead:E,canUpdate:L}}=(0,n.useRBAC)(m.settings.roles),{roles:P,isLoading:g,refetch:h}=(0,_.F)({filters:s?._q?{name:{$containsi:s._q}}:void 0},{cacheTime:0,enabled:!M&&E}),{handleNewRoleClick:x,getIcons:z,isWarningDeleteAllOpened:U,showModalConfirmButtonLoading:G,handleToggleModal:J,handleDeleteData:F}=de({refetchRoles:h,canCreate:r,canDelete:Z,canUpdate:L}),S=P.length+1,K=6;if(M)return e.createElement(u.o,null,e.createElement(n.LoadingIndicatorPage,null));const O=a({id:"global.roles",defaultMessage:"roles"});return e.createElement(u.o,null,e.createElement(n.SettingsPageTitle,{name:"Roles"}),e.createElement(A.T,{primaryAction:r?e.createElement(D.z,{onClick:x,startIcon:e.createElement(X.Z,null),size:"S"},a({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null,title:O,subtitle:a({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),as:"h2"}),E&&e.createElement(y.Z,{startActions:e.createElement(n.SearchURLQuery,{label:a({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:O})})}),E&&e.createElement(B.D,null,e.createElement(o.i,{colCount:K,rowCount:S,footer:r?e.createElement(I.c,{onClick:x,icon:e.createElement(X.Z,null)},a({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null},e.createElement(C.h,null,e.createElement(b.Tr,{"aria-rowindex":1},e.createElement(d.Th,null,e.createElement(R.Z,{variant:"sigma",textColor:"neutral600"},a({id:"global.name",defaultMessage:"Name"}))),e.createElement(d.Th,null,e.createElement(R.Z,{variant:"sigma",textColor:"neutral600"},a({id:"global.description",defaultMessage:"Description"}))),e.createElement(d.Th,null,e.createElement(R.Z,{variant:"sigma",textColor:"neutral600"},a({id:"global.users",defaultMessage:"Users"}))),e.createElement(d.Th,null,e.createElement(k.T,null,a({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(j.p,null,P?.map((f,$)=>e.createElement(se,{key:f.id,id:f.id,name:f.name,description:f.description,usersCount:f.usersCount,icons:z(f),rowIndex:$+2,canUpdate:L})))),!S&&!g&&e.createElement(ee,null)),e.createElement(n.ConfirmDialog,{isOpen:U,onConfirm:F,isConfirmButtonLoading:G,onToggleDialog:J}))},ue=()=>{const a=(0,i.useSelector)(c._);return e.createElement(n.CheckPagePermissions,{permissions:a.settings.roles.main},e.createElement(ce,null))}},55040:(N,p,t)=>{t.d(p,{Z:()=>i});var e=t(85893),n=t(96987);const i=({startActions:c,endActions:u})=>!c&&!u?null:(0,e.jsxs)(n.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(n.k,{gap:2,wrap:"wrap",children:c}),(0,e.jsx)(n.k,{gap:2,shrink:0,wrap:"wrap",children:u})]})},38454:(N,p,t)=>{t.d(p,{c:()=>B});var e=t(85893),n=t(54863),i=t(16607),c=t(26910),u=t(96987),A=t(10574);const D=(0,n.default)(i.x)`
  height: ${24/16}rem;
  width: ${24/16}rem;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;

  svg {
    height: ${10/16}rem;
    width: ${10/16}rem;
  }

  svg path {
    fill: ${({theme:o})=>o.colors.primary600};
  }
`,y=(0,n.default)(i.x)`
  border-radius: 0 0 ${({theme:o})=>o.borderRadius} ${({theme:o})=>o.borderRadius};
  display: block;
  width: 100%;
  border: none;
`,B=({children:o,icon:I,...C})=>(0,e.jsxs)("div",{children:[(0,e.jsx)(c.i,{}),(0,e.jsx)(y,{as:"button",background:"primary100",padding:5,...C,children:(0,e.jsxs)(u.k,{children:[(0,e.jsx)(D,{"aria-hidden":!0,background:"primary200",children:I}),(0,e.jsx)(i.x,{paddingLeft:3,children:(0,e.jsx)(A.Z,{variant:"pi",fontWeight:"bold",textColor:"primary600",children:o})})]})})]})}}]);
