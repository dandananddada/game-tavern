"use strict";(self.webpackChunkgame_tavern=self.webpackChunkgame_tavern||[]).push([[302],{51754:(K,m,e)=>{e.d(m,{F:()=>L});var t=e(80621),S=e(86896),E=e(88767);const L=(M={},p={})=>{const{id:i="",...f}=M,{get:y}=(0,t.useFetchClient)(),{locale:d}=(0,S.Z)(),C=(0,t.useCollator)(d,{sensitivity:"base"}),{data:n,error:O,isError:h,isLoading:o,refetch:P}=(0,E.useQuery)(["roles",i,f],async()=>{const{data:c}=await y(`/admin/roles/${i??""}`,{params:f});return c},p);let g=[];return i&&n?g=[n.data]:Array.isArray(n?.data)&&(g=n.data),{roles:g.sort((c,A)=>C.compare(c.name,A.name)),error:O,isError:h,isLoading:o,refetch:P}}},29388:(K,m,e)=>{e.r(m),e.d(m,{SingleSignOn:()=>B,default:()=>Z});var t=e(67294),S=e(71590),E=e(40720),L=e(90731),M=e(12473),p=e(34726),i=e(96987),f=e(10574),y=e(31988),d=e(6498),C=e(17705),n=e(59586),O=e(40933),h=e(82832),o=e(80621),P=e(18226),g=e(18446),c=e.n(g),A=e(86896),T=e(86706),U=e(92807),W=e(51754),b=e(36364),u=e(87561);const x=u.Ry().shape({autoRegister:u.Xg().required(o.translatedErrors.required),defaultRole:u.nK().when("autoRegister",(a,l)=>a?l.required(o.translatedErrors.required):l.nullable()),ssoLockedRoles:u.IX().nullable().of(u.nK().when("ssoLockedRoles",(a,l)=>a?l.required(o.translatedErrors.required):l.nullable()))}),B=()=>{(0,o.useFocusWhenNavigate)();const{formatMessage:a}=(0,A.Z)(),l=(0,T.useSelector)(b._),{isLoading:G,allowedActions:{canUpdate:I,canReadRoles:z}}=(0,o.useRBAC)({...l.settings.sso,readRoles:l.settings.roles.read}),[{formErrors:r,initialData:H,isLoading:N,modifiedData:v,showHeaderButtonLoader:X},,{handleChange:R,handleSubmit:k}]=(0,U.G4)("/admin/providers/options",x,()=>{},["autoRegister","defaultRole","ssoLockedRoles"]),{roles:F,isLoading:Q}=(0,W.F)(void 0,{enabled:z}),$=G||Q||N;return t.createElement(S.A,null,t.createElement(o.SettingsPageTitle,{name:"SSO"}),t.createElement(E.o,{tabIndex:-1},t.createElement("form",{onSubmit:k},t.createElement(L.T,{primaryAction:t.createElement(M.z,{"data-testid":"save-button",disabled:c()(H,v),loading:X,startIcon:t.createElement(P.Z,null),type:"submit",size:"L"},a({id:"global.save",defaultMessage:"Save"})),title:a({id:"Settings.sso.title",defaultMessage:"Single Sign-On"}),subtitle:a({id:"Settings.sso.description",defaultMessage:"Configure the settings for the Single Sign-On feature."})}),t.createElement(p.D,null,$?t.createElement(o.LoadingIndicatorPage,null):t.createElement(i.k,{direction:"column",alignItems:"stretch",gap:4,background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},t.createElement(f.Z,{variant:"delta",as:"h2"},a({id:"global.settings",defaultMessage:"Settings"})),t.createElement(y.r,{gap:4},t.createElement(d.P,{col:6,m:6,s:12},t.createElement(C.s,{"aria-label":"autoRegister","data-testid":"autoRegister",disabled:!I,checked:v.autoRegister,hint:a({id:"Settings.sso.form.registration.description",defaultMessage:"Create new user on SSO login if no account exists"}),label:a({id:"Settings.sso.form.registration.label",defaultMessage:"Auto-registration"}),name:"autoRegister",offLabel:a({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:a({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:s=>{R({target:{name:"autoRegister",value:s.target.checked}})}})),t.createElement(d.P,{col:6,m:6,s:12},t.createElement(n.P,{disabled:!I,hint:a({id:"Settings.sso.form.defaultRole.description",defaultMessage:"It will attach the new authenticated user to the selected role"}),error:r.defaultRole?a({id:r.defaultRole.id,defaultMessage:r.defaultRole.id}):"",label:a({id:"Settings.sso.form.defaultRole.label",defaultMessage:"Default role"}),name:"defaultRole",onChange:s=>{R({target:{name:"defaultRole",value:s}})},placeholder:a({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),value:v.defaultRole},F.map(({id:s,name:D})=>t.createElement(O.W,{key:s,value:s.toString()},D)))),t.createElement(d.P,{col:6,m:6,s:12},t.createElement(h.NU,{disabled:!I,hint:a({id:"Settings.sso.form.localAuthenticationLock.description",defaultMessage:"Select the roles for which you want to disable the local authentication"}),error:r.ssoLockedRoles?a({id:r.ssoLockedRoles.id,defaultMessage:r.ssoLockedRoles.id}):"",label:a({id:"Settings.sso.form.localAuthenticationLock.label",defaultMessage:"Local authentication lock-out"}),name:"ssoLockedRoles",onChange:s=>{R({target:{name:"ssoLockedRoles",value:s}})},placeholder:a({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),onClear:()=>{R({target:{name:"ssoLockedRoles",emptyArray:[]}})},value:v.ssoLockedRoles||[],withTags:!0},F.map(({id:s,name:D})=>t.createElement(h.ML,{key:s,value:s.toString()},D))))))))))},Z=()=>{const a=(0,T.useSelector)(b._);return t.createElement(o.CheckPagePermissions,{permissions:a.settings.sso.main},t.createElement(B,null))}}}]);
