(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[942],{4377:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return T}});var n=t(5893),o=t(6156),a=t(7757),s=t.n(a),c=t(2137),i=t(7294),l=t(242),u=t(6258),d=t(883),m=t(3706),g=t(5989),f=t(8703),b=t(4345),h=t(9303),p=t(7970),v=t(5831),y=t(2439),j=t(381),x=t.n(j),O=t(9469),_=t(7255),w=t(3779),N=t.n(w);function P(e){var r=e.label,t=e.name,o=e.control,a=e.className;return(0,n.jsx)(y.Qr,{control:o,name:t,render:function(e){var t,o=e.field;return(0,n.jsxs)("div",{className:"".concat(N()["rate-container"]," flex flex-col ").concat(a),children:[(0,n.jsxs)("label",{className:"mb-2 text-small",children:[r," ",o.value]}),(0,n.jsx)(O.Z,{stop:10,onChange:o.onChange,initialRating:o.value,fullSymbol:(0,n.jsx)(_.E.button,{whileHover:{scale:1.1},whileTap:{scale:.8},className:"".concat((t=o.value,t<7?"bg-[#FF5959]":t<9?"bg-[#EBFF00]":"bg-[#41FF3E]")," rounded-full  w-7 h-7 border-5 border-double border-black")}),emptySymbol:(0,n.jsx)(_.E.button,{whileHover:{scale:1.1},whileTap:{scale:.8},className:"bg-white rounded-full w-7 h-7 border-5 border-double border-black"})})]})}})}var S=t(7375),E=t(3153);function k(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function F(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?k(Object(t),!0).forEach((function(r){(0,o.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):k(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function Z(e){var r=e.label,t=e.name,o=e.control,a=(0,S.Z)(e,["label","name","control"]),s=(0,i.useState)("foreground"),c=s[0],l=s[1],u=function(e){return function(r){var t;l((t=r)<7?"bg-[#FF5959]":t<9?"bg-[#EBFF00]":"bg-[#41FF3E]"),e.onChange(r)}};return(0,n.jsx)(y.Qr,{control:o,name:t,render:function(e){var t=e.field;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(E.L,F({label:r,onChange:u(t),control:o,classNames:{filler:c},value:null===t||void 0===t?void 0:t.value},a))})}})}var D=t(9445);function C(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function L(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?C(Object(t),!0).forEach((function(r){(0,o.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var T=(0,l.Pi)((function(e){var r=e.game,t=e.afterGrade,o=D.Z.shouldGrade,a=D.Z.gameScore,l=(0,y.cI)(),j=l.register,O=l.handleSubmit,_=l.setValue,w=l.control,N=l.formState.errors,S=(0,i.useState)(!1),E=S[0],k=S[1];(0,i.useEffect)((function(){var e,r,t,n,o;a&&(_("comment",a.comment),_("art",null===(e=a.radar_score)||void 0===e?void 0:e.art),_("music",null===(r=a.radar_score)||void 0===r?void 0:r.music),_("story",null===(t=a.radar_score)||void 0===t?void 0:t.story),_("creativity",null===(n=a.radar_score)||void 0===n?void 0:n.creativity),_("gameplay",null===(o=a.radar_score)||void 0===o?void 0:o.gameplay),_("score",a.score),_("id",a.id))}),[a]);var F=function(){var e=(0,c.Z)(s().mark((function e(n){var o,a,c,i,l,m,g,f,b,h,p,v,y,j,O,_,w;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k(!0),o=n.art,a=n.music,c=n.story,i=n.creativity,l=n.gameplay,m=n.score,g=n.comment,f=r.slug,b=r.name,h=r.released,p=r.background_image,v=r.stores,y=r.genres,j=r.description,O=r.publisher,_=r.developer,w=u.Z.get("jwt"),isNaN(n.id)){e.next=11;break}return e.next=7,(0,d.Io)("/scores/".concat(n.id),{},{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(w)},body:JSON.stringify({data:{id:n.id,score:m,comment:g,radar_score:{art:o,music:a,story:c,creativity:i,gameplay:l}}})});case 7:e.sent.data.id&&(t(n),k(!1)),e.next=15;break;case 11:return e.next=13,(0,d.Io)("/score/grade",{},{method:"POST",headers:{Authorization:"Bearer ".concat(w)},body:JSON.stringify({score:m,comment:g,radar_score:{art:o,music:a,story:c,creativity:i,gameplay:l},game:{slug:f,name:b,description:j,background_image:p,publisher:O,developer:_,released:x()(h),platforms:v.map((function(e){return e.id})),genres:y.map((function(e){return e.id}))}})});case 13:e.sent.score&&(t({score:m,comment:g,radar_score:{art:o,music:a,story:c,creativity:i,gameplay:l}}),k(!1));case 15:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();return(0,n.jsx)("div",{className:"flex flex-col gap-2",children:(0,n.jsx)(m.R,{isOpen:o,onOpenChange:function(e){D.Z.update("shouldGrade",e)},scrollBehavior:"inside",children:(0,n.jsx)(y.l0,{control:w,onSubmit:O(F),render:function(e){var r=e.submit;return(0,n.jsx)(g.A,{children:function(e){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.k,{className:"flex flex-col gap-1",children:"\u63d0\u4ea4\u8bc4\u5206"}),(0,n.jsxs)(b.I,{children:[(0,n.jsx)(P,L(L({label:"\u7f8e\u672f"},j("art",{required:!1})),{},{control:w})),(0,n.jsx)(P,{label:"\u97f3\u4e50",name:"music",control:w,className:"mt-4"}),(0,n.jsx)(P,{label:"\u53d9\u4e8b",name:"story",control:w,className:"mt-4"}),(0,n.jsx)(P,{label:"\u521b\u65b0",name:"creativity",control:w,className:"mt-4"}),(0,n.jsx)(P,{label:"\u6e38\u620f\u6027",name:"gameplay",control:w,className:"mt-4"}),(0,n.jsx)(Z,{name:"score",label:"\u7efc\u5408\u4f53\u9a8c",isRequired:!0,color:"foreground",hideThumb:!0,step:.2,maxValue:10,minValue:0,defaultValue:0,control:w,errorMessage:N.score?"\u8bc4\u5206\u5728 0 - 10 \u4e4b\u95f4\uff0c\u652f\u6301\u4e00\u4f4d\u5c0f\u6570":"",className:"max-w-md mt-4"}),(0,n.jsx)(h.Y,L(L({},j("comment")),{},{label:"\u8bc4\u4ef7"}))]}),(0,n.jsxs)(p.R,{children:[(0,n.jsx)(v.A,{type:"submit",onPress:r,isLoading:E,children:"\u63d0\u4ea4\u8bc4\u5206"}),(0,n.jsx)(v.A,{color:"default",variant:"light",onPress:e,children:"\u53d6\u6d88"})]})]})}})}})})})}))},9445:function(e,r,t){"use strict";var n=t(8949),o=(0,n.ky)({_isLogin:!1,_shouldLogin:!1,_shouldRegist:!1,_shouldGrade:!1,_shouldShare:!1,_gameScore:{},get isLogin(){return this._isLogin},get shouldLogin(){return this._shouldLogin},get shouldRegist(){return this._shouldRegist},get shouldGrade(){return this._shouldGrade},get shouldShare(){return this._shouldShare},get gameScore(){return this._gameScore},update:function(e,r){if("string"===typeof e)o["_".concat(e)]=r,console.log(o);else for(var t in e)console.log(t),o["_".concat(t)]=e[t]}},{update:n.aD.bound});r.Z=o},7606:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/game/components/grade",function(){return t(4377)}])},3779:function(e){e.exports={"rate-container":"rating_rate-container__2N1SJ"}}},function(e){e.O(0,[885,661,121,635,514,169,549,774,888,179],(function(){return r=7606,e(e.s=r);var r}));var r=e.O();_N_E=r}]);